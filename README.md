# REST API сервис для сокращения ссылок

Основной функционал сервиса:

* сохранение короткого представления заданного URL
* redirect на исходный URL при переходе по сохраненному ранее короткому представлению
 
Хранилище -  PostgreSQL или in-memory.

**`https://job.ozon.ru/vacancy/?department=Ozon%20Fintech&query=Go`** `--->` **`yourdomain/52h36xlppR`**

## Начало работы
**1. Клонирование репозитория GitHub:**

```shell
# Clone from GitHub
git clone https://github.com/arsykor/url-shortener-api
```
Параметры подключения к базе данных и сервера можно изменить в файле `config.yml`.

**2. Настройка подключения к PostgreSQL**



Данный пункт можно пропустить в случае использования памяти приложения в качестве хранилища.

Запросы для создания БД, необходимых таблиц и функций находятся в файле  `database.sql`.

**3. Запуск приложения:**

```shell
# Run
go run ./...
```
По умолчанию в проекте будет использоваться память приложения в качестве хранилища. Для подключения PostgreSQL необходимо присвоить значение "db" string параметру "storage" при запуске приложения.

```shell
# Help
go run ./... --help

# PostgreSQL as a storage
go run ./... --storage db 
```

## API эндпоинты



* `POST /` - сохранение оригинального URL в хранилище и возвращение сокращённого

* `GET /:id` - redirect на соответствующий исходный URL при передаче сгенерированной ссылки 

Для тестирования корректности работы приложения можно отправить следующий запрос при помощи терминала:

```shell
# store URL: POST /

curl -X POST -H "Content-Type: application/json" -d '
[
  {
    "url": "https://job.ozon.ru/fintech/"
  }
]
' http://localhost:8080
```
 Ответ должен выглядеть примерно так:

```json
{
    "link": "http://localhost:8080/vgzJmQi5K5"
}
```
Можно перейти по сгенерированной ссылке в браузере и при успешном запросе будет совершен redirect на оригинальную URL.

**Правила оформления `POST /` запроса:**

* количество символов в оригинальной URL не должно превышать 100
* URL должна выглядеть как URL - система подразумевает валидацию
* система принимает только один объект с параметром

**Ошибки возвращаются в стандартном формате:**

```json
{
    "code": 400,
    "message": "the link for URL https://job.ozon.ru/fintech/ already exists, try using ID = vgzJmQi5K5"
}
```




## Структура проекта
 
```
.
├── cmd                  main функция приложения
├── internal             
│   ├── adapters         преобразование данных в удобный формат для use cases и сущностей
│   ├── composites       сгруппированные в древовидную структуру множества объектов
│   ├── config           конфигурация
│   ├── controllers      контроллеры
│   └── domain           
│      ├── entities      сущности
│      ├── services      поведение сущностей
│      └── usecases      бизнес-логика
├── pkg               
│   └── client           клиент БД (PostgreSQL)
├── .env                 переменные среды
├── config.yml           конфигурационный файл
└── database.sql         скрипты для создания БД
```
